---
import BaseLayout from '../layouts/BaseLayout.astro';
import { sanityClient, urlFor } from '../lib/sanity';

const posts = await sanityClient.fetch(`*[_type == "post"] | order(publishedAt desc){
  title, 
  slug, 
  publishedAt, 
  mainImage, 
  excerpt
}`);

// Função para gerar rotações nos cards (simulando colagem manual)
function getRotation(index: number) {
  const rotations = ['rotate-1', '-rotate-2', 'rotate-2', '-rotate-1'];
  return rotations[index % rotations.length];
}
---

<BaseLayout title="MIXTAPE252 // ARTE & CAOS">
  
  <section class="relative flex flex-col items-center justify-center min-h-screen p-6 text-center bg-[#f4f1ea] border-b-4 border-black overflow-hidden">
    
    <div class="relative z-10 mb-8 rotate-[-1deg]">
      <h1 class="text-6xl md:text-9xl font-black tracking-tighter uppercase leading-[0.85] text-black drop-shadow-[6px_6px_0px_rgba(0,0,0,0.15)]">
        ARTE COM VERDADE<br/>
        <span class="text-[#ff4d00] bg-black px-2 inline-block transform -skew-x-6">E CAOS CONTROLADO</span>
      </h1>
    </div>

    <div class="relative z-10 bg-white border-4 border-black p-8 max-w-2xl text-left shadow-[12px_12px_0px_0px_#111] transform rotate-1 hover:rotate-0 transition-transform duration-300">
      <ul class="list-none space-y-4 font-mono text-lg md:text-xl font-bold text-black">
        <li class="flex items-center gap-4">
          <span class="bg-black text-white px-3 py-1 text-sm border-2 border-transparent">01</span> 
          CRIAMOS COMO COLETIVO.
        </li>
        <li class="flex items-center gap-4">
          <span class="bg-black text-white px-3 py-1 text-sm border-2 border-transparent">02</span> 
          AGIMOS COMO AGÊNCIA.
        </li>
        <li class="flex items-center gap-4">
          <span class="bg-black text-white px-3 py-1 text-sm border-2 border-transparent">03</span> 
          PENSAMOS COMO BANDA PUNK.
        </li>
      </ul>
      <div class="mt-8 pt-4 border-t-4 border-black flex flex-col md:flex-row md:items-center justify-between text-xs md:text-sm font-sans uppercase tracking-widest text-gray-600 gap-2">
        <span>Sem métrica.</span>
        <span>Sem algoritmo.</span>
      </div>
    </div>

    <a href="#zine" class="relative z-10 mt-16 px-12 py-5 bg-[#ff4d00] text-white border-4 border-black font-black text-2xl uppercase tracking-wide hover:bg-black hover:text-white hover:-translate-y-2 hover:shadow-[8px_8px_0px_0px_#000] transition-all duration-200 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
      Acessar Zine ↓
    </a>

  </section>

  <section id="zine" class="py-24 px-4 bg-white min-h-screen relative">
    <div class="container mx-auto max-w-7xl">
      
      <div class="mb-20 flex items-center justify-center md:justify-start">
        <h2 class="text-5xl md:text-8xl font-black uppercase tracking-tighter bg-black text-white px-4 py-2 transform -rotate-2 shadow-[8px_8px_0px_0px_#ff4d00]">
          Latest Drops
        </h2>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 md:gap-16 px-4">
        {posts.map((post: any, index: number) => (
          <a 
            href={`/post/${post.slug.current}`} 
            class={`group block relative bg-[#f4f1ea] border-4 border-black h-full hover:z-20 hover:scale-105 transition-all duration-300 shadow-[8px_8px_0px_0px_#000] hover:shadow-[16px_16px_0px_0px_#ff4d00] ${getRotation(index)}`}
          >
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-24 h-6 bg-white/50 backdrop-blur-sm border border-gray-300 rotate-1 shadow-sm z-10"></div>

            <div class="aspect-square border-b-4 border-black overflow-hidden relative">
              {post.mainImage ? (
                <img 
                  src={urlFor(post.mainImage).width(600).height(600).url()} 
                  alt={post.title}
                  class="w-full h-full object-cover grayscale contrast-125 group-hover:grayscale-0 transition-all duration-500 scale-100 group-hover:scale-110"
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center bg-neutral-200 font-mono">NO SIGNAL</div>
              )}
              
              <div class="absolute bottom-0 right-0 bg-black text-white text-xs font-mono px-3 py-1 border-t-4 border-l-4 border-black">
                {new Date(post.publishedAt).toLocaleDateString('pt-BR')}
              </div>
            </div>

            <div class="p-6 flex flex-col gap-4">
              <h3 class="text-3xl font-black uppercase leading-[0.9] group-hover:text-[#ff4d00] transition-colors">
                {post.title}
              </h3>
              <p class="font-mono text-xs md:text-sm text-gray-800 leading-tight line-clamp-3 border-l-2 border-black pl-3">
                {post.excerpt}
              </p>
            </div>
          </a>
        ))}
      </div>

    </div>
  </section>

</BaseLayout>
