---
import { urlFor } from "../lib/sanity";
import ChannelBadge from "./ChannelBadge.astro";

interface Props {
    post: any; // Using any for now as per existing patterns, but ideally should be typed
    index: number;
}

const { post, index } = Astro.props;

// Helper function for format styling
function getFormatStyle(format: string) {
    switch (format) {
        case "news":
            return { label: "#NEWS", color: "bg-yellow-400 text-black" };
        case "review":
            return { label: "#REVIEW", color: "bg-purple-600 text-white" };
        case "interview":
            return { label: "#ENTREVISTA", color: "bg-blue-600 text-white" };
        case "article":
        default:
            return { label: "#ORIGINAL", color: "bg-safety-orange text-white" };
    }
}

const style = getFormatStyle(post.format);
const rotationClass = index % 2 === 0 ? "rotate-2" : "-rotate-2";
---

<a
    href={`/post/${post.slug.current}`}
    class={`group relative bg-white border-4 border-ink p-4 shadow-[6px_6px_0px_0px_#111] hover:shadow-[2px_2px_0px_0px_#111] transition-all duration-300 transform hover:translate-x-[4px] hover:translate-y-[4px] flex flex-col h-full ${rotationClass}`}
>
    <div class="overflow-hidden border-2 border-ink mb-4 relative aspect-video">
        {
            post.mainImage ? (
                <img
                    src={urlFor(post.mainImage).width(600).height(400).url()}
                    alt={post.title}
                    class="w-full h-full object-cover grayscale contrast-125 group-hover:grayscale-0 group-hover:contrast-100 transition-all duration-500 scale-100 group-hover:scale-110"
                />
            ) : (
                <div class="w-full h-full flex items-center justify-center bg-gray-200 font-headline text-xl">
                    NO SIGNAL
                </div>
            )
        }

        {/* Channel Badge (Top Left) */}
        <div class="absolute top-0 left-0 z-10">
            <ChannelBadge channel={post.channel} />
        </div>

        {/* Format Badge (Bottom Right - Over Image) */}
        <div
            class={`absolute bottom-0 right-0 ${style.color} text-xs font-bold px-2 py-1 border-l-2 border-t-2 border-ink font-mono uppercase z-10`}
        >
            {style.label}
        </div>
    </div>

    <h4
        class="text-2xl font-headline uppercase leading-[0.9] mb-4 group-hover:text-safety-orange transition-colors flex-grow"
    >
        {post.title}
    </h4>

    <p
        class="text-sm font-bold border-t-2 border-ink pt-2 mt-auto flex justify-between font-body"
    >
        <span>
            {new Date(post.publishedAt).toLocaleDateString("pt-BR")}
        </span>
        <span>LER MAIS -></span>
    </p>
</a>
